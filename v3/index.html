<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Microexpressões — v3 simples (P&B)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
    <link rel="icon" href="data:,">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.min.js"></script>
    <style>
      :root{ color-scheme:dark; }
      *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
      html,body{ margin:0; background:#000; color:#fff; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; }
      #app{ min-height:100svh; display:grid; place-items:center; }
      canvas{ display:block; }

      /* Overlays */
      .overlay{
        position:fixed; inset:0; display:grid; place-items:center;
        background:rgba(0,0,0,.86); padding:20px; z-index:10;
      }
      .card{
        width:min(720px,92vw); background:#121212; border:1px solid #242424;
        border-radius:16px; padding:18px 20px; box-shadow:0 16px 50px rgba(0,0,0,.45);
      }
      h1{ font-size:18px; margin:0 0 8px; }
      p{ font-size:14px; color:#d2d2d2; margin:0 0 10px; line-height:1.5; }
      label{ display:flex; gap:10px; align-items:flex-start; font-size:14px; color:#e7e7e7; }
      input[type="checkbox"]{ transform: translateY(3px) scale(1.1); }
      button{
        margin-top:12px; width:100%; background:#1f6feb; color:#fff; border:none;
        padding:12px 16px; border-radius:12px; font-size:16px; font-weight:700; cursor:pointer;
        opacity:.6; pointer-events:none; transition:.2s;
      }
      button.enabled{ opacity:1; pointer-events:auto; }
      .meta{ font-size:12px; color:#9aa4af; margin-top:6px; }

      /* Enquadramento */
      .frame-overlay{
        position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
        pointer-events:none; z-index:5;
      }
      .frame-guide{
        width:min(70vmin,85vw); aspect-ratio:1/1; border:2px dashed rgba(255,255,255,.9); border-radius:12px;
        box-shadow:0 0 0 9999px rgba(0,0,0,.25) inset;
      }
      .frame-tip{
        margin-top:12px; color:#e0e0e0; font-size:14px; text-align:center; text-shadow:0 1px 0 #000;
      }
      .frame-actions{
        position:fixed; left:0; right:0; bottom:calc(env(safe-area-inset-bottom,0) + 24px); display:grid; place-items:center;
        pointer-events:auto; z-index:11;
      }
      .frame-actions button{ width: clamp(180px, 42vw, 260px); }

      .hint{ position:fixed; left:8px; top:8px; font:12px/1.3 system-ui; color:#bbb; z-index:2; }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <div class="hint">P&B • ajuste THRESHOLD e HOLD_FRAMES no sketch.js</div>

    <!-- 1) Gate (consentimento + iniciar) -->
    <div id="gate" class="overlay">
      <div class="card">
        <h1>Transplante de Microexpressões — simples (P&B)</h1>
        <p>Ao iniciar, tentaremos usar sua câmera como <strong>Vídeo A</strong>. Se não for possível, usaremos vídeos locais. Um vídeo será sorteado como <strong>Vídeo B</strong>.</p>
        <label><input id="consent" type="checkbox"> <span>Autorizo o uso temporário da minha imagem via câmera neste experimento local.</span></label>
        <button id="startBtn">Iniciar</button>
        <div class="meta">No celular, use <strong>HTTPS</strong> ou <strong>http://localhost</strong> para liberar a câmera.</div>
      </div>
    </div>

    <!-- 2) Enquadramento (quadrado + OK) -->
    <div id="frameUI" class="frame-overlay" style="display:none">
      <div class="frame-guide" aria-hidden="true"></div>
      <div class="frame-tip">Aproxime/afaste até preencher o quadrado. Quando estiver bom, toque <strong>OK</strong>.</div>
      <div class="frame-actions"><button id="okFrameBtn" class="enabled">OK</button></div>
    </div>

    <script>
      // Habilita botão após consentimento
      window.addEventListener('DOMContentLoaded', () => {
        const consent = document.getElementById('consent');
        const startBtn = document.getElementById('startBtn');
        if (consent && startBtn) {
          startBtn.classList.toggle('enabled', consent.checked);
          consent.addEventListener('change', () => {
            startBtn.classList.toggle('enabled', consent.checked);
          });
        }
      });
    </script>

    <script defer src="./sketch.js"></script>
  </body>
</html>
